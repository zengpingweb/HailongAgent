<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>海龙智言 - V31.0 微信兼容终版</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Aldrich&family=Noto+Sans+SC:wght@300;400;500&display=swap');

        :root {
            --primary-bg: #010413;
            --accent-color-1: #00eaff; /* 极光青 */
            --accent-color-2: #ff00c1; /* 霓虹粉 */
            --primary-text: #f0f8ff;
            --secondary-text: #7a8aa0;
            --font-display: 'Aldrich', sans-serif;
            --font-body: 'Noto Sans SC', sans-serif;
            --ios-ui-color: #f0f8ff;
        }

        /* ✅【V31.0 修复】核心改动开始 */
        /* 1. 锁定 html 和 body，防止外层滚动干扰 */
        html, body {
            height: 100%;
            overflow: hidden; /* 禁止页面主体滚动 */
            margin: 0;
            padding: 0;
            background-color: #000;
            font-family: var(--font-body);
        }

        /* 2. 创建内部滚动容器 */
        .page-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow-y: auto; /* 让这个容器自己滚动 */
            -webkit-overflow-scrolling: touch; /* 在iOS/微信中实现平滑滚动 */
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 40px 0;
            box-sizing: border-box;
        }
        /* ✅【V31.0 修复】核心改动结束 */
        
        .phone-mockup {
            width: 390px;
            height: 844px;
            background-color: var(--primary-bg);
            border-radius: 50px;
            box-shadow: 0 0 150px rgba(0, 234, 255, 0.3), 0 0 60px rgba(255, 0, 193, 0.2);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        #three-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }

        .global-ui-overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 30;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .system-status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px 10px;
            color: var(--ios-ui-color);
            font-size: 15px;
            font-weight: 500;
        }
        .status-bar-right { display: flex; align-items: center; gap: 7px; }
        .status-bar-right svg { width: auto; height: 12px; fill: currentColor; }
        #battery-icon { height: 13px; }

        .home-indicator {
            width: 134px; height: 5px; background-color: var(--ios-ui-color);
            border-radius: 2.5px; opacity: 0.8; align-self: center; margin-bottom: 8px;
        }
        
        .screen {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 2;
            display: flex; flex-direction: column; box-sizing: border-box;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }
        .screen.active {
            opacity: 1;
            pointer-events: all;
        }

        #listening-screen, #monitoring-popup { z-index: 15; }
        #chat-history-screen { z-index: 25; }

        #home-screen {
            justify-content: space-between;
            padding-top: 50px; padding-bottom: 34px;
        }
        
        .app-header {
            padding: 5px 20px;
            display: flex; justify-content: space-between;
            align-items: center; flex-shrink: 0; position: relative; z-index: 5;
        }
        .app-header .app-title {
            flex-grow: 1; text-align: center; font-size: 18px;
            font-weight: 500; color: var(--primary-text);
        }
        #chat-history-btn {
            width: 44px; height: 44px; display: flex;
            justify-content: center; align-items: center; cursor: pointer;
            opacity: 0.7; transition: opacity 0.3s ease;
        }
        #chat-history-btn:hover { opacity: 1; }
        #chat-history-btn svg { width: 26px; height: 26px; stroke: var(--secondary-text); stroke-width: 1.8; transition: stroke 0.3s ease; }
        #chat-history-btn:hover svg { stroke: var(--primary-text); }
        .header-placeholder { width: 44px; }

        .header {
            padding: 0 30px; text-align: center;
            margin-top: 30px; position: relative; z-index: 5;
        }
        .header h1 { font-size: 40px; font-family: var(--font-display); margin: 0; background: linear-gradient(90deg, var(--accent-color-1), var(--primary-text)); -webkit-background-clip: text; color: transparent; animation: fadeInDown 1s ease-out; }
        .header p { font-size: 16px; color: var(--secondary-text); margin: 8px 0 0; font-weight: 300; animation: fadeInDown 1s 0.2s ease-out; }
        .main-content { flex-grow: 1; display: flex; justify-content: center; align-items: center; }
        .footer { height: 160px; display: flex; justify-content: center; align-items: center; flex-shrink: 0; position: relative; z-index: 5; }
        #mic-button-final { width: 90px; height: 90px; border-radius: 50%; background: radial-gradient(circle, var(--accent-color-1) 0%, var(--accent-color-2) 100%); display: flex; justify-content: center; align-items: center; cursor: pointer; position: relative; border: 2px solid rgba(0, 234, 255, 0.5); animation: core-pulse 2s infinite ease-in-out; }
        #mic-button-final::before, #mic-button-final::after { content: ''; position: absolute; border-radius: 50%; }
        #mic-button-final::before { width: 100%; height: 100%; border: 2px solid var(--accent-color-1); animation: sonar-ping 2s infinite cubic-bezier(0.45, 0.05, 0.55, 0.95); }
        #mic-button-final::after { width: calc(100% + 10px); height: calc(100% + 10px); box-shadow: 0 0 20px var(--accent-color-1), inset 0 0 10px rgba(0, 234, 255, 0.5); animation: halo-breath 4s infinite ease-in-out; }
        #mic-button-final svg { width: 48px; height: 48px; stroke: #010413; z-index: 1; }
        
        #listening-screen {
            background-color: rgba(1, 4, 19, 0.5); backdrop-filter: blur(10px);
            justify-content: center; align-items: center;
        }
        .listening-content-wrapper {
             display: flex;
             flex-direction: column;
             align-items: center;
             padding-top: 80px;
        }
        .transcribed-text { 
            font-size: 24px;
            font-weight: 400; 
            min-height: auto; 
            line-height: 1.6; 
            color: var(--primary-text); 
            text-align: center; 
            text-shadow: 0 0 15px rgba(0, 234, 255, 0.7); 
            margin-bottom: 40px; 
            animation: fadeIn 1s ease;
        }
        #wave-canvas { width: 100%; height: 150px; }
        
        #monitoring-popup {
            display: flex; 
            justify-content: center;
            align-items: center;
        }
        .popup-content { 
            width: 90%; 
            background: rgba(1, 4, 19, 0.8); 
            backdrop-filter: blur(20px) saturate(150%); 
            border: 1px solid rgba(0, 234, 255, 0.3); 
            border-radius: 12px; 
            box-shadow: 0 0 50px rgba(0, 234, 255, 0.1); 
            position: relative; 
            padding: 0;
            margin-top: -80px; 
            opacity: 0;
            transform: scale(0.95) translateY(10px);
            transition: opacity 0.25s ease-out, transform 0.25s ease-out;
        }
        #monitoring-popup.active .popup-content { 
            opacity: 1;
            transform: scale(1) translateY(0);
        }
        .popup-header { padding: 8px 8px 8px 15px; border-bottom: 1px solid rgba(0, 234, 255, 0.2); display: flex; justify-content: space-between; align-items: center; }
        .popup-header h2 { margin: 0; font-size: 16px; font-family: var(--font-body); color: var(--accent-color-1); display: flex; align-items: center; gap: 8px; flex-grow: 1; }
        .popup-header .rec-dot { width: 8px; height: 8px; background-color: #ff3b30; border-radius: 50%; animation: rec-blink 1.5s infinite; }
        .header-controls { display: flex; align-items: center; gap: 8px; }
        .header-controls .close-btn { width: 28px; height: 28px; cursor: pointer; color: var(--secondary-text); transition: color 0.3s, opacity 0.3s; opacity: 0.7; }
        .header-controls .close-btn:hover { color: var(--primary-text); opacity: 1;}
        .hud-btn { background: transparent; border: none; padding: 4px; opacity: 0.7; cursor: pointer; transition: opacity 0.3s; display: flex; justify-content: center; align-items: center; }
        .hud-btn:hover { opacity: 1; }
        .hud-btn svg { width: 20px; height: 20px; stroke: var(--primary-text); }
        .video-container { padding: 10px; }
        .video-placeholder { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 8px; position: relative; overflow: hidden; }

        #chat-history-screen {
            background-color: rgba(1, 4, 19, 0.7); backdrop-filter: blur(15px);
            padding-top: 50px; padding-bottom: 34px;
        }
        .chat-header { padding: 10px 15px; flex-shrink: 0; display: flex; align-items: center; border-bottom: 1px solid rgba(0, 234, 255, 0.2); position: relative; text-align: center; }
        .chat-header .back-btn { position: absolute; left: 15px; cursor: pointer; }
        .chat-header .back-btn svg { width: 24px; height: 24px; stroke: var(--secondary-text); transition: stroke 0.3s; }
        .chat-header .back-btn:hover svg { stroke: var(--primary-text); }
        .chat-header h3 { flex-grow: 1; margin: 0; font-size: 18px; font-weight: 500; color: var(--primary-text); text-shadow: 0 0 8px var(--accent-color-1); }
        .chat-log-container { flex-grow: 1; overflow-y: auto; padding: 20px 15px; }
        .chat-message { display: flex; gap: 10px; margin-bottom: 25px; max-width: 85%; animation: fadeIn 0.5s ease-out; }
        .chat-message .avatar { width: 40px; height: 40px; border-radius: 50%; flex-shrink: 0; display: flex; justify-content: center; align-items: center; font-weight: 500; }
        .chat-message .message-bubble { padding: 12px 16px; border-radius: 12px; line-height: 1.6; font-size: 15px; }
        .chat-message .timestamp { font-size: 12px; color: var(--secondary-text); margin-top: 6px; }
        .chat-message.agent { float: left; clear: both; }
        .agent .avatar { background: linear-gradient(45deg, var(--accent-color-2), #4a00e0); color: #fff; font-family: var(--font-display); }
        .agent .message-content { display: flex; flex-direction: column; align-items: flex-start; }
        .agent .message-bubble { background-color: rgba(10, 20, 40, 0.7); border-top-left-radius: 2px; color: var(--primary-text); }
        .chat-message.user { float: right; clear: both; flex-direction: row-reverse; }
        .user .avatar { background: linear-gradient(45deg, #ddd, #fff); color: #333; }
        .user .message-content { display: flex; flex-direction: column; align-items: flex-end; }
        .user .message-bubble { background-color: rgba(0, 234, 255, 0.15); border-top-right-radius: 2px; color: #e0faff; }
        
        .chat-input-area {
            flex-shrink: 0; padding: 8px 12px 8px 20px; margin: 0 15px 15px 15px;
            background: rgba(28, 28, 30, 0.8); border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px); display: flex; align-items: center; gap: 10px; border-radius: 25px;
        }
        .chat-input-area input[type="text"] { flex-grow: 1; background: transparent; border: none; height: 30px; color: var(--primary-text); font-size: 15px; outline: none; }
        .chat-input-area input[type="text"]::placeholder { color: var(--secondary-text); font-weight: 300; }
        .chat-input-area .icon-btn { width: 30px; height: 30px; cursor: pointer; color: var(--accent-color-1); opacity: 0.8; transition: opacity 0.3s; display: flex; align-items: center; justify-content: center; }
        .chat-input-area .icon-btn svg { width: 20px; height: 20px; }
        .chat-input-area .icon-btn:hover { opacity: 1; }
        
        @keyframes fadeInDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes core-pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}@keyframes sonar-ping{from{transform:scale(1);opacity:1}to{transform:scale(2.5);opacity:0}}@keyframes halo-breath{0%,100%{opacity:.7}50%{opacity:1}}@keyframes rec-blink{0%,100%{opacity:1;box-shadow:0 0 5px #ff3b30}50%{opacity:.5;box-shadow:none}}
    </style>
</head>
<body>
    <div class="page-wrapper">
        <div class="phone-mockup">
            <canvas id="three-canvas"></canvas>

            <div class="screen active" id="home-screen">
                <div class="app-header">
                    <div id="chat-history-btn" title="查看对话记录">
                         <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                    </div>
                    <h2 class="app-title">海龙智言</h2>
                    <div class="header-placeholder"></div>
                </div>
                <div class="header">
                    <h1>HAILONG AGENT</h1>
                    <p>您的智能运营助理已就位</p>
                </div>
                <div class="main-content"></div>
                <div class="footer">
                    <div id="mic-button-final">
                         <svg viewBox="0 0 48 48" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 18v12M18 15v18M24 12v24M30 15v18M36 18v12"/></svg>
                    </div>
                </div>
            </div>

            <div class="screen" id="chat-history-screen">
                <div class="chat-header">
                    <div class="back-btn" id="back-to-home-btn" title="返回主页"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></div>
                    <h3>对话记录</h3>
                </div>
                <div class="chat-log-container">
                    <div class="chat-message user"><div class="message-content"><div class="message-bubble">给我调取7楼走廊A区的监控...</div><div class="timestamp">09:41:15</div></div><div class="avatar">我</div></div>
                    <div class="chat-message agent"><div class="avatar">A</div><div class="message-content"><div class="message-bubble">遵命。已为您连接至7楼走廊A区实时监控画面。</div><div class="timestamp">09:41:17</div></div></div>
                    <div class="chat-message user"><div class="message-content"><div class="message-bubble">分析最近2小时的异常人流。</div><div class="timestamp">09:52:03</div></div><div class="avatar">我</div></div>
                    <div class="chat-message agent"><div class="avatar">A</div><div class="message-content"><div class="message-bubble">正在分析... 分析完成。在 08:55 至 09:02 期间，检测到非授权人员在禁区逗留，已标记并生成报告。是否需要查看详细报告？</div><div class="timestamp">09:52:08</div></div></div>
                </div>
                <div class="chat-input-area">
                    <input type="text" placeholder="输入消息或语音...">
                    <div class="icon-btn">
                         <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line></svg>
                    </div>
                </div>
            </div>

            <div class="screen" id="listening-screen">
                <div class="listening-content-wrapper">
                     <div class="transcribed-text" id="transcribed-text">正在聆听...</div>
                     <canvas id="wave-canvas"></canvas>
                </div>
            </div>
            <div class="screen" id="monitoring-popup">
                 <div class="popup-content">
                    <div class="popup-header">
                        <h2><span class="rec-dot"></span>监控画面: 7楼 - 走廊 A区</h2>
                        <div class="header-controls">
                            <div class="hud-btn" id="fullscreen-btn"><svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg></div>
                            <svg id="close-popup-btn" class="close-btn" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        </div>
                    </div>
                    <div class="video-container"><div class="video-placeholder"></div></div>
                </div>
            </div>

            <div class="global-ui-overlay">
                <div class="system-status-bar">
                    <div class="status-bar-left"><span id="time">9:41</span></div>
                    <div class="status-bar-right">
                        <svg id="signal-icon" viewBox="0 0 18 14"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.28 1.71997C14.6891 1.31086 15.3223 1.31086 15.7314 1.71997C16.1405 2.12908 16.1405 2.76224 15.7314 3.17135L11.9028 7.00003L15.7314 10.8287C16.1405 11.2378 16.1405 11.871 15.7314 12.2801C15.3223 12.6892 14.6891 12.6892 14.28 12.2801L10.4514 8.4514L6.62277 12.2801C6.21366 12.6892 5.5805 12.6892 5.17139 12.2801C4.76228 11.871 4.76228 11.2378 5.17139 10.8287L9.00006 7.00003L5.17139 3.17135C4.76228 2.76224 4.76228 2.12908 5.17139 1.71997C5.5805 1.31086 6.21366 1.31086 6.62277 1.71997L10.4514 5.54865L14.28 1.71997Z" opacity="0.4" transform="matrix(0.707107 -0.707107 0.707107 0.707107 -4.94975 12.3744)"></path><path d="M12.9498 0.380737C13.582 0.380737 13.9498 0.748522 13.9498 1.38074V12.6192C13.9498 13.2515 13.582 13.6192 12.9498 13.6192H10.4498C9.81751 13.6192 9.44977 13.2515 9.44977 12.6192V1.38074C9.44977 0.748522 9.81751 0.380737 10.4498 0.380737H12.9498Z" opacity="0.4"></path><path d="M8.44977 3.38074C9.08198 3.38074 9.44977 3.74852 9.44977 4.38074V12.6192C9.44977 13.2515 9.08198 13.6192 8.44977 13.6192H5.94977C5.31755 13.6192 4.94977 13.2515 4.94977 12.6192V4.38074C4.94977 3.74852 5.31755 3.38074 5.94977 3.38074H8.44977Z"></path><path d="M3.94977 6.38074C4.58198 6.38074 4.94977 6.74852 4.94977 7.38074V12.6192C4.94977 13.2515 4.58198 13.6192 3.94977 13.6192H1.44977C0.817552 13.6192 0.449768 13.2515 0.449768 12.6192V7.38074C0.449768 6.74852 0.817552 6.38074 1.44977 6.38074H3.94977Z"></path></svg>
                        <svg id="battery-icon" viewBox="0 0 25 12"><path d="M22.5.5h-20C1.12.5.5 1.12.5 1.75v8.5c0 .63.62 1.25 1.25 1.25h20c.63 0 1.25-.62 1.25-1.25v-8.5C23.75 1.12 23.13.5 22.5.5zm.5 9.75c0 .28-.22.5-.5.5h-20c-.28 0-.5-.22-.5-.5v-8.5c0-.28.22-.5.5-.5h20c.28 0 .5.22.5.5v8.5z" opacity=".4"></path><path d="M24.5 3.75v4.5c.69 0 1.25-.56 1.25-1.25v-2c0-.69-.56-1.25-1.25-1.25z" opacity=".4"></path><path d="M2.5 2.5h19v7h-19z"></path></svg>
                    </div>
                </div>
                <div class="home-indicator"></div>
            </div>
        </div>
    </div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    const timeEl = document.getElementById('time');
    function updateTime() {
        const now = new Date();
        timeEl.textContent = now.getHours() + ':' + now.getMinutes().toString().padStart(2, '0');
    }
    updateTime(); setInterval(updateTime, 1000);

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, 390 / 844, 1, 1000);
    camera.position.z = 100;
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('three-canvas'), antialias: true, alpha: true });
    renderer.setSize(390, 844);
    const particlesGeometry = new THREE.BufferGeometry();
    const particlesCount = 2000;
    const positions = new Float32Array(particlesCount * 3);
    for (let i = 0; i < particlesCount * 3; i++) { positions[i] = (Math.random() - 0.5) * (i % 3 === 1 ? 400 : 200); }
    particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    const particlesMaterial = new THREE.PointsMaterial({ color: 0x00eaff, size: 0.2, transparent: true, opacity: 0.5 });
    const particleSystem = new THREE.Points(particlesGeometry, particlesMaterial);
    scene.add(particleSystem);
    const agentCoreGroup = new THREE.Group();
    const coreGeometry = new THREE.IcosahedronGeometry(12, 1);
    const coreMaterial = new THREE.MeshStandardMaterial({ color: 0x00eaff, emissive: 0x00eaff, emissiveIntensity: 2, transparent: true, opacity: 0.7 });
    const coreMesh = new THREE.Mesh(coreGeometry, coreMaterial);
    agentCoreGroup.add(coreMesh);
    const wireframeMesh = new THREE.Mesh(coreGeometry, new THREE.MeshBasicMaterial({ color: 0x00eaff, wireframe: true, transparent: true, opacity: 0.3 }));
    wireframeMesh.scale.set(1.05, 1.05, 1.05);
    agentCoreGroup.add(wireframeMesh);
    
    agentCoreGroup.position.y = 0; 
    
    scene.add(agentCoreGroup);
    const light1 = new THREE.PointLight(0x00eaff, 2, 200); light1.position.set(50, 50, 50); scene.add(light1);
    const light2 = new THREE.PointLight(0xff00c1, 2, 200); light2.position.set(-50, -50, 50); scene.add(light2);
    function animateBg() { requestAnimationFrame(animateBg); particleSystem.rotation.y += 0.0005; agentCoreGroup.rotation.y += 0.005; renderer.render(scene, camera); }
    animateBg();

    const homeScreen = document.getElementById('home-screen');
    const chatHistoryScreen = document.getElementById('chat-history-screen');
    const listeningScreen = document.getElementById('listening-screen');
    const monitoringPopup = document.getElementById('monitoring-popup');
    
    const chatHistoryBtn = document.getElementById('chat-history-btn');
    const backToHomeBtn = document.getElementById('back-to-home-btn');
    const micButton = document.getElementById('mic-button-final');
    const closePopupBtn = document.getElementById('close-popup-btn');

    chatHistoryBtn.addEventListener('click', () => {
        homeScreen.classList.remove('active');
        chatHistoryScreen.classList.add('active');
    });

    backToHomeBtn.addEventListener('click', () => {
        chatHistoryScreen.classList.remove('active');
        homeScreen.classList.add('active');
    });
    
    micButton.addEventListener('click', () => {
        listeningScreen.classList.add('active');
        const sampleText = "给我调取7楼走廊A区的监控...";
        const transcribedText = document.getElementById('transcribed-text');
        let charIndex = 0;
        transcribedText.textContent = '';
        const typingInterval = setInterval(() => {
            if (charIndex < sampleText.length) {
                transcribedText.textContent += sampleText[charIndex];
                charIndex++;
            } else {
                clearInterval(typingInterval);
                setTimeout(() => {
                    listeningScreen.classList.remove('active');
                    monitoringPopup.classList.add('active');
                }, 1000);
            }
        }, 100);
    });

    closePopupBtn.addEventListener('click', () => {
        monitoringPopup.classList.remove('active');
    });
    
    const waveCanvas = document.getElementById('wave-canvas');
    if (waveCanvas) {
        const waveCtx = waveCanvas.getContext('2d');
        let waveTime = 0;
        function drawWave() {
            if (!listeningScreen.classList.contains('active')) return;
            waveCtx.clearRect(0, 0, waveCanvas.width, waveCanvas.height);
            waveCtx.lineWidth = 2; waveCtx.strokeStyle = '#00eaff';
            for (let i = 0; i < 3; i++) {
                waveCtx.globalAlpha = 1 - i * 0.3;
                waveCtx.beginPath();
                for (let x = 0; x < waveCanvas.width; x++) { const y = Math.sin(x * 0.05 + waveTime + i) * 20 * (1 + Math.sin(x*0.1 + waveTime)) + waveCanvas.height / 2; if (x === 0) waveCtx.moveTo(x, y); else waveCtx.lineTo(x, y); }
                waveCtx.stroke();
            }
            waveTime += 0.05;
            requestAnimationFrame(drawWave);
        }
        micButton.addEventListener('click', () => {
            waveTime = 0;
            requestAnimationFrame(drawWave);
        });
    }

</script>
</body>
</html>